#include <stdio.h>
#include <mach/mach.h>
#include <sys/mman.h>

#include "iokit.h"

/*
com.apple.iokit.IOAcceleratorFamily:__text:FFFFFFF006CF9D80 __ZN22IOGraphicsAccelerator213newUserClientEP4taskPvjPP12IOUserClient
__int64 __fastcall IOGraphicsAccelerator2::newUserClient(
        struct_a1 *a1,
        task *a2,
        __int64 securityID,
        __int64 type,
        IOUserClient **a5) {
...
  switch ( (int)type )
  ...
    case 2:                                     // kIOAccelContext2Type
      v20 = ((__int64 (__fastcall *)(struct_a1 *))a1->IOGA2_vt->field_688)(a1);// sub_FFFFFFF006D0F980
      v19 = (IOUserClient *)v20;
      if ( v20 )
      {
        if ( IOAccelContext2::init(v20, 0, a2) )
          goto LABEL_17;
        goto LABEL_22;
      }
      break;
...
   case 5:                                     // kIOAccelDevice2Type
      v22 = a1->IOGA2_vt->__ZN22IOGraphicsAccelerator29newDeviceEv((IOGraphicsAccelerator2 *)a1);
      v19 = (IOUserClient *)v22;
      if ( v22 )
      {
        if ( !IOAccelDevice2::init(v22, 0, a2) )
          goto LABEL_22;
        goto LABEL_26;
      }
*/
#define kIOAccelContext2Type 2
#define kIOAccelDevice2Type 5


/*
com.apple.iokit.IOAcceleratorFamily:__text:FFFFFFF006CFE888 __ZN20IOAccelCommandQueue214externalMethodEjP25IOExternalMethodArgumentsP24IOExternalMethodDispatchP8OSObjectPv
__int64 __fastcall IOAccelCommandQueue2::externalMethod(
        __int64 a1,
        uint32_t a2,
        IOExternalMethodArguments *a3,
        IOExternalMethodDispatch *a4,
        OSObject *a5,
        void *a6)
{
...
    a4 = (IOExternalMethodDispatch *)&IOAccelCommandQueue2::sCommandQueueMethods[3 * a2]; 
...

com.apple.iokit.IOAcceleratorFamily:__const:FFFFFFF006FDC070 __ZN20IOAccelCommandQueue220sCommandQueueMethodsE DCQ __ZN20IOAccelCommandQueue223s_set_notification_portEPS_PvP25IOExternalMethodArguments
com.apple.iokit.IOAcceleratorFamily:__const:FFFFFFF006FDC070                                         ; DATA XREF: IOAccelCommandQueue2::externalMethod(uint,IOExternalMethodArguments *,IOExternalMethodDispatch *,OSObject *,void *)+8â†‘o
com.apple.iokit.IOAcceleratorFamily:__const:FFFFFFF006FDC070                                         ; IOAccelCommandQueue2::s_set_notification_port(IOAccelCommandQueue2*,void *,IOExternalMethodArguments *)
com.apple.iokit.IOAcceleratorFamily:__const:FFFFFFF006FDC078                 DCQ 0
com.apple.iokit.IOAcceleratorFamily:__const:FFFFFFF006FDC080                 DCQ 0
com.apple.iokit.IOAcceleratorFamily:__const:FFFFFFF006FDC088                 DCQ __ZN20IOAccelCommandQueue224s_submit_command_buffersEPS_PvP25IOExternalMethodArguments ; IOAccelCommandQueue2::s_submit_command_buffers(IOAccelCommandQueue2*,void *,IOExternalMethodArguments *)
com.apple.iokit.IOAcceleratorFamily:__const:FFFFFFF006FDC090                 DCQ 0xFFFFFFFF00000000
com.apple.iokit.IOAcceleratorFamily:__const:FFFFFFF006FDC098                 DCQ 0
com.apple.iokit.IOAcceleratorFamily:__const:FFFFFFF006FDC0A0                 DCQ __ZN20IOAccelCommandQueue229s_set_priority_and_backgroundEPS_PvP25IOExternalMethodArguments ; IOAccelCommandQueue2::s_set_priority_and_background(IOAccelCommandQueue2*,void *,IOExternalMethodArguments *)
com.apple.iokit.IOAcceleratorFamily:__const:FFFFFFF006FDC0A8                 DCQ 0xC00000000
com.apple.iokit.IOAcceleratorFamily:__const:FFFFFFF006FDC0B0                 DCQ 0
com.apple.iokit.IOAcceleratorFamily:__const:FFFFFFF006FDC0B8                 DCQ __ZN20IOAccelCommandQueue224s_get_command_queue_infoEPS_PvP25IOExternalMethodArguments ; IOAccelCommandQueue2::s_get_command_queue_info(IOAccelCommandQueue2*,void *,IOExternalMethodArguments *)
com.apple.iokit.IOAcceleratorFamily:__const:FFFFFFF006FDC0C0                 DCQ 0
com.apple.iokit.IOAcceleratorFamily:__const:FFFFFFF006FDC0C8                 DCQ 0x800000000
com.apple.iokit.IOAcceleratorFamily:__const:FFFFFFF006FDC0D0                 DCQ __ZN20IOAccelCommandQueue224s_set_quality_of_serviceEPS_PvP25IOExternalMethodArguments ; IOAccelCommandQueue2::s_set_quality_of_service(IOAccelCommandQueue2*,void *,IOExternalMethodArguments *)
com.apple.iokit.IOAcceleratorFamily:__const:FFFFFFF006FDC0D8                 DCQ 0x800000000
com.apple.iokit.IOAcceleratorFamily:__const:FFFFFFF006FDC0E0                 DCQ 0
com.apple.iokit.IOAcceleratorFamily:__const:FFFFFFF006FDC0E8                 DCQ __ZN20IOAccelCommandQueue214s_set_get_infoEPS_PvP25IOExternalMethodArguments ; IOAccelCommandQueue2::s_set_get_info(IOAccelCommandQueue2*,void *,IOExternalMethodArguments *)
com.apple.iokit.IOAcceleratorFamily:__const:FFFFFFF006FDC0F0                 DCQ 0x40800000000
com.apple.iokit.IOAcceleratorFamily:__const:FFFFFFF006FDC0F8                 DCQ 0x800000000
*/
#define IOAccelCommandQueue2_set_notification_port_selector 0

int IOAccelerator_init(void);
void IOAccelerator_deinit(void);