#include <mach/mach.h>

/*
00000000 struct mach_msg_header_t // sizeof=0x20
00000000 {
00000000     mach_msg_bits_t msgh_bits;
00000004     mach_msg_size_t msgh_size;
00000008     mach_port_t msgh_remote_port;
00000010     mach_port_t msgh_local_port;
00000018     mach_port_name_t msgh_voucher_port;
0000001C     mach_msg_id_t msgh_id;
00000020 };

00000000 struct mach_msg_body_t // sizeof=0x4
00000000 {                                       // XREF: mach_gss_init_sec_context::Reply/r
00000000                                         // mach_gss_init_sec_context::Request/r ...
00000000     mach_msg_size_t msgh_descriptor_count;
00000004 };

00000000 struct mach_msg_ool_ports_descriptor_t // sizeof=0x10
00000000 {                                       // XREF: __Reply__mach_ports_lookup_t/r
00000000                                         // __Request__mach_ports_register_t/r ...
00000000     void *address;
00000008.0   __int32 deallocate : 8;
00000008.8   unsigned __int32 copy : 8;
00000008.16  unsigned __int32 disposition : 8;
00000008.24  unsigned __int32 type : 8;
0000000C     mach_msg_size_t count;
00000010 };

*/

struct ool_msg  {
    mach_msg_header_t hdr;
    mach_msg_body_t body;
    mach_msg_ool_ports_descriptor_t ool_ports;
};

mach_port_t fill_kalloc_with_port_pointer(mach_port_t target_port, int count, int disposition);