#include "find_pipe.h"
#include "kextrw.h"
#include "proc.h"
#include "offsets.h"
#include <stdio.h>

int obtain_pipe_kaddr(int rfd) {
	
	uint64_t p_fd = (proc_of_pid(getpid()) + off_p_pfd); 
	uint64_t fileproc = kextrw_kread64(p_fd + off_fd_ofiles);
	uint64_t rpipe_fp = kextrw_kread64(fileproc + rfd * 8);
	uint64_t r_fp_glob = kextrw_kread64(rpipe_fp + off_fp_fglob);
	uint64_t rpipe = kextrw_kread64(r_fp_glob + off_fg_data); 
	uint64_t pipe_base = kextrw_kread64(rpipe + off_pb_buffer); 
	
    return xpaci(pipe_base);
}
